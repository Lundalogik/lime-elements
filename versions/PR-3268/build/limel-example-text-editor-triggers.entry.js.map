{"version":3,"names":["textEditorCustomTriggersCss","TextEditorCustomTriggersExample","constructor","hostRef","this","handleGlobalKeyPress","event","key","ESCAPE","stopPropagation","preventDefault","close","emit","insertModeButtons","id","title","selected","items","text","value","icon","handleTriggerStart","triggerState","isPickerOpen","triggerFunction","detail","handleTriggerStop","inputText","handleTriggerChange","toLowerCase","renderPicker","filter","item","includes","h","containerStyle","containerId","portalId","visible","openDirection","inheritParentWidth","anchor","textEditorElement","renderList","length","style","padding","onChange","handleListChange","type","insertMode","insert","node","tagName","attributes","handleInsertModeChange","createRandomString","globalClickListener","bind","watchOpen","setupGlobalHandlers","componentWillLoad","document","addEventListener","capture","removeEventListener","render","class","label","display","ref","el","plugins","triggers","onTriggerStart","onTriggerStop","onTriggerChange","element","target","clickedInside","portalContains","host"],"sources":["./src/components/text-editor/examples/text-editor-custom-triggers.scss?tag=limel-example-text-editor-triggers&encapsulation=shadow","./src/components/text-editor/examples/text-editor-custom-triggers.tsx"],"sourcesContent":["limel-button-group {\n    min-width: 8rem;\n}\n\nlimel-example-controls {\n    margin-bottom: 0.25rem;\n    display: flex;\n    flex-wrap: wrap;\n}\n\n.mode {\n    display: flex;\n    flex-wrap: nowrap;\n}\n\n.value {\n    display: flex;\n    gap: 0.5rem;\n}\n\nlimel-portal {\n    width: auto;\n}\n","import { Button, ListItem, TextEditorInserter } from '@limetech/lime-elements';\nimport {\n    Component,\n    h,\n    State,\n    Element,\n    Event,\n    EventEmitter,\n    Watch,\n} from '@stencil/core';\nimport { createRandomString } from 'src/util/random-string';\nimport { portalContains } from '../../portal/contains';\nimport { ESCAPE } from '../../../util/keycodes';\n\n/**\n * Custom triggers\n *\n * A trigger is a character or sequence of characters that if typed in the text editor\n * will initiate a trigger session. The session is initialized with a `triggerStart`\n * event. Subsequent characters written after the trigger sequence will be sent in a\n * `triggerChange` event. When the focus is removed from the trigger a `triggerStop`\n * event will be sent.\n *\n * The `triggerStart` event contains a `TextEditorInserter` object containing functions\n * to manipulate the state of the text editor around the trigger. Using any of the\n * supplied methods will effectivly replace the trigger content in the text editor with\n * the content of choice.\n *\n * In this example we pass either a text or a `limel-chip` representing some chosen user\n * in a mention like situation.\n */\n@Component({\n    tag: 'limel-example-text-editor-triggers',\n    shadow: true,\n    styleUrl: 'text-editor-custom-triggers.scss',\n})\nexport class TextEditorCustomTriggersExample {\n    constructor() {\n        this.portalId = createRandomString();\n        this.globalClickListener = this.globalClickListener.bind(this);\n    }\n    @State()\n    private value: string = '';\n\n    @State()\n    private triggerState: string = '';\n\n    @State()\n    private inputText: string = '';\n\n    @State()\n    private isPickerOpen: boolean = false;\n\n    @State()\n    private textEditorElement: HTMLElement;\n\n    @State()\n    private insertMode: 'text' | 'chip' = 'text';\n\n    @Element()\n    private host: HTMLLimelPopoverElement;\n\n    /**\n     * Emits an event when the component is closing\n     */\n    @Event()\n    private close: EventEmitter<void>;\n\n    @Watch('isPickerOpen')\n    protected watchOpen() {\n        this.setupGlobalHandlers();\n    }\n\n    public componentWillLoad() {\n        this.setupGlobalHandlers();\n    }\n\n    private setupGlobalHandlers() {\n        if (this.isPickerOpen) {\n            document.addEventListener('click', this.globalClickListener, {\n                capture: true,\n            });\n            document.addEventListener('keyup', this.handleGlobalKeyPress);\n        } else {\n            document.removeEventListener('click', this.globalClickListener);\n            document.removeEventListener('keyup', this.handleGlobalKeyPress);\n        }\n    }\n\n    private handleGlobalKeyPress = (event: KeyboardEvent) => {\n        if (event.key !== ESCAPE) {\n            return;\n        }\n\n        event.stopPropagation();\n        event.preventDefault();\n        this.close.emit();\n    };\n\n    private insertModeButtons: Button[] = [\n        {\n            id: '1',\n            title: 'text',\n            selected: true,\n        },\n        {\n            id: '2',\n            title: 'chip',\n        },\n    ];\n\n    private portalId: string;\n    private items: Array<ListItem<number>> = [\n        { text: 'Wolverine', value: 1, icon: 'wolf' },\n        { text: 'Captain America', value: 2, icon: 'captain_america' },\n        { text: 'Superman', value: 3, icon: 'superman' },\n        { text: 'Tony Stark', value: 4, icon: 'iron_man' },\n        { text: 'Batman', value: 5, icon: 'batman_old' },\n    ];\n\n    private triggerFunction?: TextEditorInserter;\n\n    public render() {\n        return [\n            <limel-example-controls>\n                Insert mode:\n                <limel-button-group\n                    class=\"mode\"\n                    value={this.insertModeButtons}\n                    onChange={this.handleInsertModeChange}\n                />\n                <div class=\"value\">\n                    <limel-example-value\n                        label=\"Action\"\n                        value={this.triggerState}\n                    />\n                    <limel-example-value\n                        label=\"Tag value\"\n                        value={this.inputText}\n                    />\n                </div>\n            </limel-example-controls>,\n            <limel-text-editor\n                style={{ display: 'block' }}\n                ref={(el) => (this.textEditorElement = el)}\n                value={this.value}\n                plugins={[\n                    { tagName: 'limel-chip', attributes: ['text', 'icon'] },\n                ]}\n                triggers={['@']}\n                onTriggerStart={this.handleTriggerStart}\n                onTriggerStop={this.handleTriggerStop}\n                onTriggerChange={this.handleTriggerChange}\n            />,\n            this.renderPicker(),\n        ];\n    }\n\n    private handleTriggerStart = (event: CustomEvent<TextEditorInserter>) => {\n        this.triggerState = 'start';\n        this.isPickerOpen = true;\n        this.triggerFunction = event.detail;\n    };\n\n    private handleTriggerStop = () => {\n        this.triggerState = 'stop';\n        this.inputText = '';\n        this.isPickerOpen = false;\n    };\n\n    private handleTriggerChange = (event: CustomEvent<string>) => {\n        this.inputText = event.detail.toLowerCase();\n    };\n\n    private renderPicker = () => {\n        if (!this.isPickerOpen) {\n            return;\n        }\n\n        const items = this.items.filter((item: ListItem<number>) =>\n            item.text.toLowerCase().includes(this.inputText),\n        );\n\n        return [\n            <limel-portal\n                containerStyle={{\n                    'background-color': 'rgb(var(--contrast-100))',\n                    'border-radius': '0.5rem',\n                    'box-shadow': 'var(--shadow-depth-16)',\n                }}\n                containerId={this.portalId}\n                visible={this.isPickerOpen}\n                openDirection=\"bottom-start\"\n                inheritParentWidth={true}\n                anchor={this.textEditorElement}\n            >\n                {this.renderList(items)}\n            </limel-portal>,\n        ];\n    };\n\n    private globalClickListener(event: MouseEvent) {\n        const element: HTMLElement = event.target as HTMLElement;\n        const clickedInside = portalContains(this.host, element);\n        if (this.isPickerOpen && !clickedInside) {\n            event.stopPropagation();\n            event.preventDefault();\n            this.isPickerOpen = false;\n            this.close.emit();\n        }\n    }\n\n    private renderList = (items) => {\n        if (items.length === 0) {\n            return (\n                <div style={{ padding: '0.5rem' }}>\n                    Couldn't find. Not a hero yet! ðŸ¥²\n                </div>\n            );\n        }\n\n        return (\n            <limel-list\n                items={items}\n                onChange={this.handleListChange}\n                type=\"selectable\"\n            />\n        );\n    };\n\n    private handleListChange = (event: CustomEvent<ListItem<number>>) => {\n        if (this.insertMode === 'text') {\n            this.triggerFunction.insert('@' + event.detail.text);\n\n            return;\n        }\n\n        this.triggerFunction.insert({\n            node: {\n                tagName: 'limel-chip',\n                attributes: {\n                    icon: event.detail.icon,\n                    text: event.detail.text,\n                },\n            },\n        });\n    };\n\n    private handleInsertModeChange = (event: CustomEvent<Button>) => {\n        this.insertMode = event.detail.title as any;\n    };\n}\n"],"mappings":"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"}