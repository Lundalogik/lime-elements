{"version":3,"names":["hotkeyCss","Hotkey","this","registeredNormalizedHotkey","connectedCallback","updateRegistry","disconnectedCallback","unregister","valueWatcher","disabledWatcher","render","isApple","isAppleDevice","parts","tokenizeHotkeyString","value","ariaLabel","_a","trim","h","Host","undefined","map","part","index","display","isGlyph","formatDisplayToken","key","class","token","trimmed","lower","toLowerCase","handleKeyDown","event","disabled","defaultPrevented","repeat","handledFlag","isKeyboardEventFromTextInput","expected","normalizeHotkeyString","pressed","hotkeyFromKeyboardEvent","warnIfDuplicateHotkey","hotkeyTrigger","emit","hotkey","keyboardEvent","duplicateWarnedFlag","instances","instancesByHotkey","get","count","size","console","warn","next","set","Set","add","delete","Map"],"sources":["./src/components/hotkey/hotkey.scss?tag=limel-hotkey&encapsulation=shadow","./src/components/hotkey/hotkey.tsx"],"sourcesContent":["@forward '../markdown/partial-styles/_kbd.scss';\n:host(limel-hotkey) {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 0.25rem;\n}\n\n:host(limel-hotkey[disabled]:not([disabled='false'])) {\n    opacity: 0.5;\n}\n\nkbd {\n    margin: 0;\n    font-size: 0.75rem;\n    box-shadow:\n        var(--button-shadow-pressed),\n        0 0.625rem 0.375px -0.5rem rgb(var(--color-black), 0.02),\n        0 0.025rem 0.5rem 0 rgb(var(--contrast-100)) inset;\n}\n\nspan {\n    display: inline-block;\n    &::first-letter {\n        text-transform: uppercase;\n    }\n}\n\nkbd.is-glyph {\n    span {\n        transform: scale(1.2);\n    }\n}\n","import {\n    Component,\n    Event,\n    EventEmitter,\n    Host,\n    Listen,\n    Prop,\n    Watch,\n    h,\n} from '@stencil/core';\nimport {\n    hotkeyFromKeyboardEvent,\n    isKeyboardEventFromTextInput,\n    normalizeHotkeyString,\n    tokenizeHotkeyString,\n} from '../../util/hotkeys';\nimport { isAppleDevice } from '../../util/device';\nimport { LimelHotkeyTriggerDetail } from './hotkey.types';\n\n/**\n * This component is used internally to visualize hotkeys in other components,\n * such as the menu. It will also emit an event when the hotkey is pressed,\n * so that the parent component can react to it.\n *\n * @exampleComponent limel-example-hotkey-basic\n * @exampleComponent limel-example-hotkey-disabled\n * @exampleComponent limel-example-hotkey-duplicates\n * @private\n */\n@Component({\n    tag: 'limel-hotkey',\n    shadow: true,\n    styleUrl: 'hotkey.scss',\n})\nexport class Hotkey {\n    /**\n     * The hotkey\n     */\n    @Prop({ reflect: true })\n    public value: string;\n\n    /**\n     * When disabled, the hotkey is still rendered but will not emit events.\n     */\n    @Prop({ reflect: true })\n    public disabled = false;\n\n    /**\n     * Emits when the configured hotkey is pressed.\n     */\n    @Event({ bubbles: true, composed: true })\n    public hotkeyTrigger: EventEmitter<LimelHotkeyTriggerDetail>;\n\n    private static readonly handledFlag = '__limelHotkeyHandled';\n    private static readonly duplicateWarnedFlag =\n        '__limelHotkeyDuplicateWarned';\n    private static readonly instancesByHotkey = new Map<string, Set<Hotkey>>();\n\n    private registeredNormalizedHotkey: string | null = null;\n\n    public connectedCallback() {\n        this.updateRegistry();\n    }\n\n    public disconnectedCallback() {\n        this.unregister();\n    }\n\n    @Watch('value')\n    protected valueWatcher() {\n        this.updateRegistry();\n    }\n\n    @Watch('disabled')\n    protected disabledWatcher() {\n        this.updateRegistry();\n    }\n\n    public render() {\n        const isApple = isAppleDevice();\n        const parts = tokenizeHotkeyString(this.value);\n        const ariaLabel = (this.value ?? '').trim();\n\n        return (\n            <Host aria-label={ariaLabel || undefined}>\n                {parts.map((part, index) => {\n                    const { display, isGlyph } = this.formatDisplayToken(\n                        part,\n                        isApple\n                    );\n\n                    return (\n                        <kbd\n                            key={`${part}-${index}`}\n                            class={isGlyph ? 'is-glyph' : undefined}\n                        >\n                            <span>{display}</span>\n                        </kbd>\n                    );\n                })}\n            </Host>\n        );\n    }\n\n    private formatDisplayToken(\n        token: string,\n        isApple: boolean\n    ): {\n        display: string;\n        isGlyph: boolean;\n    } {\n        const trimmed = (token ?? '').trim();\n        if (!trimmed) {\n            return { display: '', isGlyph: false };\n        }\n\n        if (trimmed === '+') {\n            return { display: '+', isGlyph: false };\n        }\n\n        const lower = trimmed.toLowerCase();\n\n        switch (lower) {\n            case 'meta': {\n                return isApple\n                    ? { display: '⌘', isGlyph: true }\n                    : { display: '⊞ Win', isGlyph: false };\n            }\n\n            case 'cmd':\n            case 'command': {\n                return { display: '⌘', isGlyph: true };\n            }\n\n            case 'alt':\n            case 'option': {\n                return isApple\n                    ? { display: '⌥', isGlyph: true }\n                    : { display: 'Alt', isGlyph: false };\n            }\n\n            case 'shift': {\n                return { display: '⇧', isGlyph: true };\n            }\n\n            case 'enter':\n            case 'return': {\n                return { display: '↩', isGlyph: true };\n            }\n\n            case 'tab': {\n                return { display: '⇥', isGlyph: true };\n            }\n\n            case 'delete':\n            case 'del':\n            case 'backspace': {\n                if (isApple) {\n                    return { display: '⌫', isGlyph: true };\n                }\n                return lower === 'backspace'\n                    ? { display: 'Backspace', isGlyph: false }\n                    : { display: 'Del', isGlyph: false };\n            }\n\n            case 'ctrl':\n            case 'control': {\n                return { display: 'Ctrl', isGlyph: false };\n            }\n        }\n\n        return { display: trimmed, isGlyph: false };\n    }\n\n    @Listen('keydown', { target: 'document', capture: true })\n    public handleKeyDown(event: KeyboardEvent) {\n        if (this.disabled) {\n            return;\n        }\n\n        if (event.defaultPrevented || event.repeat) {\n            return;\n        }\n\n        if ((event as any)[Hotkey.handledFlag]) {\n            return;\n        }\n\n        if (!this.value) {\n            return;\n        }\n\n        if (isKeyboardEventFromTextInput(event)) {\n            return;\n        }\n\n        const expected = normalizeHotkeyString(this.value);\n        if (!expected) {\n            return;\n        }\n\n        const pressed = hotkeyFromKeyboardEvent(event);\n        if (!pressed || pressed !== expected) {\n            return;\n        }\n\n        this.warnIfDuplicateHotkey(expected, event);\n\n        (event as any)[Hotkey.handledFlag] = true;\n        this.hotkeyTrigger.emit({\n            hotkey: expected,\n            value: this.value,\n            keyboardEvent: event,\n        });\n    }\n\n    private warnIfDuplicateHotkey(expected: string, event: KeyboardEvent) {\n        if ((event as any)[Hotkey.duplicateWarnedFlag]) {\n            return;\n        }\n\n        const instances = Hotkey.instancesByHotkey.get(expected);\n        const count = instances?.size ?? 0;\n        if (count <= 1) {\n            return;\n        }\n\n        (event as any)[Hotkey.duplicateWarnedFlag] = true;\n\n        console.warn(\n            `[limel-hotkey] Duplicate hotkey detected: \"${expected}\" is configured ` +\n                `${count} times among enabled <limel-hotkey> instances. ` +\n                `Only the first handler will run for each keypress.`\n        );\n    }\n\n    private updateRegistry() {\n        const next =\n            !this.disabled && this.value\n                ? normalizeHotkeyString(this.value)\n                : null;\n\n        if (next === this.registeredNormalizedHotkey) {\n            return;\n        }\n\n        this.unregister();\n\n        if (!next) {\n            return;\n        }\n\n        let set = Hotkey.instancesByHotkey.get(next);\n        if (!set) {\n            set = new Set();\n            Hotkey.instancesByHotkey.set(next, set);\n        }\n\n        set.add(this);\n        this.registeredNormalizedHotkey = next;\n    }\n\n    private unregister() {\n        const key = this.registeredNormalizedHotkey;\n        if (!key) {\n            return;\n        }\n\n        const set = Hotkey.instancesByHotkey.get(key);\n        set?.delete(this);\n        if (set && set.size === 0) {\n            Hotkey.instancesByHotkey.delete(key);\n        }\n\n        this.registeredNormalizedHotkey = null;\n    }\n}\n"],"mappings":"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"}