{"version":3,"file":"search.js","sourceRoot":"","sources":["../../src/kompendium/search.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n    AliasDescription,\n    EnumDescription,\n    InterfaceDescription,\n    KompendiumData,\n    KompendiumDocument,\n    MenuItem,\n} from '../types';\nimport Fuse from 'fuse.js';\nimport {\n    JsonDocs,\n    JsonDocsComponent,\n    JsonDocsEvent,\n    JsonDocsProp,\n    JsonDocsTag,\n} from '@stencil/core/internal';\n\nexport function createIndex(data: KompendiumData): any {\n    const docs = createDocs(data);\n    const keys: Fuse.FuseOptionKey[] = [\n        'tags',\n        'title',\n        'path',\n        'text',\n        'props.name',\n        'props.text',\n        'props.tags',\n        'props.type',\n        'events.name',\n        'events.text',\n        'events.tags',\n        'events.type',\n    ];\n\n    const index = Fuse.createIndex(keys, docs);\n\n    return {\n        documents: docs,\n        data: index.toJSON(),\n    };\n}\n\nfunction createDocs(data: KompendiumData): KompendiumDocument[] {\n    return Array.from(createDocuments(data.menu, data));\n}\n\nexport function* createDocuments(\n    items: MenuItem[],\n    data: KompendiumData,\n): Generator<KompendiumDocument> {\n    for (const item of items) {\n        if (isIndexable(item)) {\n            const document = createDocument(item, data);\n            if (document) {\n                yield document;\n            }\n        }\n\n        if (item.children?.length) {\n            yield* createDocuments(item.children, data);\n        }\n    }\n}\n\nfunction isIndexable(item: MenuItem): boolean {\n    if (item.path?.match(/^\\/component\\/[\\w-]+\\/$/)) {\n        return true;\n    }\n\n    return !!item.children?.length;\n}\n\nfunction createDocument(\n    item: MenuItem,\n    data: KompendiumData,\n): KompendiumDocument {\n    if (item.path?.startsWith('/component/')) {\n        return createComponentDocument(item, data);\n    } else if (item.path?.startsWith('/type/')) {\n        return createTypeDocument(item, data);\n    }\n\n    return createGuideDocument(item, data);\n}\n\nfunction createComponentDocument(\n    item: MenuItem,\n    data: KompendiumData,\n): KompendiumDocument {\n    const tag = item.path.split('/')[2];\n    const component = data.docs.components.find((c) => c.tag === tag);\n    if (!component) {\n        return;\n    }\n\n    const examples = findExamples(component, data.docs);\n\n    return {\n        path: item.path,\n        title: item.title,\n        text: [component.docs, ...examples.map((e) => e.docs)],\n        props: component.props.map(createPropDocument),\n        events: component.events.map(createPropDocument),\n        tags: component.docsTags.map(createTagDocument),\n    };\n}\n\nfunction createTypeDocument(\n    item: MenuItem,\n    data: KompendiumData,\n): KompendiumDocument {\n    const type = data.types?.find((t) => t.name === item.title);\n\n    if (type?.type === 'interface') {\n        return createInterfaceDocument(item, type as InterfaceDescription);\n    } else if (type?.type === 'alias') {\n        return createAliasDocument(item, type as AliasDescription);\n    } else if (type?.type === 'enum') {\n        return createEnumDocument(item, type as EnumDescription);\n    }\n}\n\nfunction createGuideDocument(\n    item: MenuItem,\n    data: KompendiumData,\n): KompendiumDocument {\n    const guide = data.guides?.find((g) => g.data.path === item.path);\n\n    return {\n        path: item.path,\n        title: item.title,\n        text: guide?.content,\n    };\n}\n\nfunction createInterfaceDocument(\n    item: MenuItem,\n    type: InterfaceDescription,\n): KompendiumDocument {\n    return {\n        path: item.path,\n        title: item.title,\n        text: type.docs,\n        props: type.props.map(createPropDocument),\n        tags: type.docsTags?.map(createTagDocument),\n    };\n}\n\nfunction createAliasDocument(\n    item: MenuItem,\n    type: AliasDescription,\n): KompendiumDocument {\n    return {\n        path: item.path,\n        title: item.title,\n        text: type.docs,\n    };\n}\n\n// eslint-disable-next-line sonarjs/no-identical-functions\nfunction createEnumDocument(\n    item: MenuItem,\n    type: EnumDescription,\n): KompendiumDocument {\n    return {\n        path: item.path,\n        title: item.title,\n        text: type.docs,\n    };\n}\n\nfunction findExamples(component: JsonDocsComponent, docs: JsonDocs) {\n    return component.docsTags\n        .filter(isTag('exampleComponent'))\n        .map(findComponentByTag(docs));\n}\n\nconst findComponentByTag = (docs: JsonDocs) => (tag: JsonDocsTag) => {\n    return docs.components.find((component) => component.tag === tag.text);\n};\n\nconst isTag = (name: string) => (tag: JsonDocsTag) => {\n    return tag.name === name;\n};\n\nfunction createPropDocument(prop: JsonDocsProp | JsonDocsEvent) {\n    return {\n        name: (prop as JsonDocsProp).name || (prop as JsonDocsEvent).event,\n        tags: prop.docsTags?.map(createTagDocument),\n        text: prop.docs,\n        type: (prop as JsonDocsProp)?.type || (prop as JsonDocsEvent).detail,\n    };\n}\n\nfunction createTagDocument(tag: JsonDocsTag) {\n    return [tag.name, tag.text].join(' ');\n}\n"]}