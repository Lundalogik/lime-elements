{"version":3,"names":["TextEditorWithInlineImagesExample","this","metadata","links","images","handleFailedThumbnailChange","event","uploadImageFails","detail","handleChange","value","handleImagePasted","async","imageInserter","insertThumbnail","imageSrc","uploadImage","fileInfo","insertImage","insertFailedThumbnail","Promise","resolve","reject","setTimeout","error","console","filename","handleMetadataChange","removedImages","getRemovedImages","forEach","image","log","fileInfoId","state","ImageState","SUCCESS","removeImage","render","h","Host","onChange","onImagePasted","onMetadataChange","label","oldMetadata","newMetadata","filter","oldImage","some","newImage","Error"],"sources":["./src/components/text-editor/examples/text-editor-with-inline-images-file-storage.tsx"],"sourcesContent":["import { Component, h, State, Host } from '@stencil/core';\nimport {\n    ImageInserter,\n    FileInfo,\n    ImageInfo,\n    LimelTextEditorCustomEvent,\n    LimelCheckboxCustomEvent,\n    MetadataInfo,\n    ImageState,\n} from '@limetech/lime-elements';\n/**\n * Handling inline images (with external file storage)\n *\n * To allow users to paste images directly into the text editor, you can\n * listen to the `imagePasted` event, which is triggered when an image file\n * is pasted into the editor.\n *\n * The `imagePasted` event contains an `ImageInserter` object, which you can\n * use to insert a thumbnail of the pasted image into the editor.\n * After the thumbnail is inserted, you can upload the image to an external\n * file storage and insert the src url of the uploaded image using the\n * `insertImage` method.\n *\n * If the image upload fails, you can insert a failed thumbnail using the\n * `insertFailedThumbnail` method.\n *\n * :::note\n * In this example, because we don't actually upload the image you paste\n * anywhere, once the \"upload\" is done, we will replace the image you\n * pasted with a url to an image of the Lime CRM logo.\n *\n * In reality, you would of course insert the url to the newly uploaded\n * image instead.\n */\n@Component({\n    tag: 'limel-example-text-editor-with-inline-images-file-storage',\n    shadow: true,\n})\nexport class TextEditorWithInlineImagesExample {\n    @State()\n    private value = 'Copy an image file and paste it here.';\n\n    @State()\n    private uploadImageFails = false;\n\n    private metadata: MetadataInfo = { links: [], images: [] };\n\n    public render() {\n        return (\n            <Host>\n                <limel-text-editor\n                    value={this.value}\n                    onChange={this.handleChange}\n                    onImagePasted={this.handleImagePasted}\n                    onMetadataChange={this.handleMetadataChange}\n                />\n                <limel-checkbox\n                    label=\"Upload image fails - insert failed thumbnail\"\n                    onChange={this.handleFailedThumbnailChange}\n                />\n                <limel-example-value label=\"Value\" value={this.value} />\n            </Host>\n        );\n    }\n\n    private handleFailedThumbnailChange = (\n        event: LimelCheckboxCustomEvent<boolean>,\n    ) => {\n        this.uploadImageFails = event.detail;\n    };\n\n    private handleChange = (event: LimelTextEditorCustomEvent<string>) => {\n        this.value = event.detail;\n    };\n\n    private handleImagePasted = async (\n        event: LimelTextEditorCustomEvent<ImageInserter>,\n    ) => {\n        const imageInserter = event.detail;\n\n        imageInserter.insertThumbnail();\n\n        const imageSrc = await this.uploadImage(imageInserter.fileInfo);\n        if (imageSrc) {\n            imageInserter.insertImage(imageSrc);\n        } else {\n            imageInserter.insertFailedThumbnail();\n        }\n    };\n\n    private uploadImage = async (fileInfo: FileInfo): Promise<string> => {\n        try {\n            // Upload image to external file storage.\n            // fileInfo.fileContent contains the image data.\n\n            // Simulate upload delay.\n            const imageSrc: string = await new Promise((resolve, reject) => {\n                setTimeout(() => {\n                    if (this.uploadImageFails) {\n                        reject('Server error');\n                    } else {\n                        resolve('https://cdn.lime-crm.com/mail-addin-logo.png');\n                    }\n                }, 2000);\n            });\n\n            // Return the src url of the uploaded image.\n            return imageSrc;\n        } catch (error) {\n            console.error(\n                `Failed to upload image ${fileInfo.filename}: ${error}`,\n            );\n        }\n    };\n\n    private handleMetadataChange = (\n        event: LimelTextEditorCustomEvent<MetadataInfo>,\n    ) => {\n        const removedImages = this.getRemovedImages(\n            this.metadata,\n            event.detail,\n        );\n\n        removedImages.forEach((image) => {\n            console.log(`Image removed: ${image.fileInfoId}`);\n\n            if (image.state === ImageState.SUCCESS) {\n                this.removeImage(image);\n            }\n        });\n\n        this.metadata = event.detail;\n    };\n\n    private getRemovedImages(\n        oldMetadata: MetadataInfo,\n        newMetadata: MetadataInfo,\n    ): ImageInfo[] {\n        return oldMetadata.images.filter(\n            (oldImage) =>\n                !newMetadata.images.some(\n                    (newImage) => newImage.fileInfoId === oldImage.fileInfoId,\n                ),\n        );\n    }\n\n    private removeImage(image: ImageInfo) {\n        // Remove image from external file storage if desired.\n\n        try {\n            throw new Error('Not implemented.');\n        } catch (error) {\n            console.error(`Failed to remove image ${image.fileInfoId}`, error);\n        }\n    }\n}\n"],"mappings":"kJAsCaA,EAAiC,M,yBAOlCC,KAAAC,SAAyB,CAAEC,MAAO,GAAIC,OAAQ,IAoB9CH,KAAAI,4BACJC,IAEAL,KAAKM,iBAAmBD,EAAME,MAAM,EAGhCP,KAAAQ,aAAgBH,IACpBL,KAAKS,MAAQJ,EAAME,MAAM,EAGrBP,KAAAU,kBAAoBC,MACxBN,IAEA,MAAMO,EAAgBP,EAAME,OAE5BK,EAAcC,kBAEd,MAAMC,QAAiBd,KAAKe,YAAYH,EAAcI,UACtD,GAAIF,EAAU,CACVF,EAAcK,YAAYH,E,KACvB,CACHF,EAAcM,uB,GAIdlB,KAAAe,YAAcJ,MAAOK,IACzB,IAKI,MAAMF,QAAyB,IAAIK,SAAQ,CAACC,EAASC,KACjDC,YAAW,KACP,GAAItB,KAAKM,iBAAkB,CACvBe,EAAO,e,KACJ,CACHD,EAAQ,+C,IAEb,IAAK,IAIZ,OAAON,C,CACT,MAAOS,GACLC,QAAQD,MACJ,0BAA0BP,EAASS,aAAaF,I,GAKpDvB,KAAA0B,qBACJrB,IAEA,MAAMsB,EAAgB3B,KAAK4B,iBACvB5B,KAAKC,SACLI,EAAME,QAGVoB,EAAcE,SAASC,IACnBN,QAAQO,IAAI,kBAAkBD,EAAME,cAEpC,GAAIF,EAAMG,QAAUC,EAAWC,QAAS,CACpCnC,KAAKoC,YAAYN,E,KAIzB9B,KAAKC,SAAWI,EAAME,MAAM,E,WA3FhB,wC,sBAGW,K,CAIpB8B,SACH,OACIC,EAACC,EAAI,KACDD,EAAA,qBACI7B,MAAOT,KAAKS,MACZ+B,SAAUxC,KAAKQ,aACfiC,cAAezC,KAAKU,kBACpBgC,iBAAkB1C,KAAK0B,uBAE3BY,EAAA,kBACIK,MAAM,+CACNH,SAAUxC,KAAKI,8BAEnBkC,EAAA,uBAAqBK,MAAM,QAAQlC,MAAOT,KAAKS,Q,CA0EnDmB,iBACJgB,EACAC,GAEA,OAAOD,EAAYzC,OAAO2C,QACrBC,IACIF,EAAY1C,OAAO6C,MACfC,GAAaA,EAASjB,aAAee,EAASf,c,CAKvDI,YAAYN,GAGhB,IACI,MAAM,IAAIoB,MAAM,mB,CAClB,MAAO3B,GACLC,QAAQD,MAAM,0BAA0BO,EAAME,aAAcT,E"}