{"version":3,"file":"app.js","sourceRoot":"","sources":["../../../src/components/app/app.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, h, State, Prop, Watch } from '@stencil/core';\nimport { KompendiumData, KompendiumDocument } from '../../types';\nimport { setTypes } from '../markdown/markdown-types';\nimport Fuse from 'fuse.js';\nimport { PropsFactory } from '../playground/playground.types';\n\n@Component({\n    tag: 'kompendium-app',\n    styleUrl: 'app.scss',\n    shadow: true,\n})\nexport class App {\n    /**\n     * Path to `kompendium.json`\n     */\n    @Prop()\n    public path = '/kompendium.json';\n\n    /**\n     * Factory for creating props for example components\n     */\n    @Prop()\n    public examplePropsFactory?: PropsFactory;\n\n    @State()\n    public data: KompendiumData;\n\n    @State()\n    private index: Fuse<KompendiumDocument>;\n\n    private socket: WebSocket;\n\n    constructor() {\n        this.onMessage = this.onMessage.bind(this);\n    }\n\n    protected componentWillLoad(): void {\n        this.createWebSocket();\n        this.fetchData();\n    }\n\n    @Watch('data')\n    protected watchData(): void {\n        const options: Fuse.IFuseOptions<KompendiumDocument> = {\n            includeScore: true,\n            includeMatches: true,\n            ignoreLocation: true,\n            threshold: 0.4,\n        };\n        const index = Fuse.parseIndex(this.data.index.data);\n\n        this.index = new Fuse<KompendiumDocument>(\n            this.data.index.documents,\n            options,\n            index,\n        );\n    }\n\n    private createWebSocket() {\n        if (this.socket) {\n            return;\n        }\n\n        const url = getSocketUrl(location);\n        this.socket = new WebSocket(url);\n        this.socket.addEventListener('message', this.onMessage);\n    }\n\n    private onMessage(event: MessageEvent) {\n        try {\n            const data = JSON.parse(event.data);\n            if (data.buildLog?.progress === 1) {\n                this.fetchData();\n            }\n        } catch (e) {\n            // eslint-disable-next-line no-console\n            console.error(e);\n        }\n    }\n\n    private async fetchData() {\n        const data = await fetch(this.path);\n        this.data = await data.json();\n        const typeNames = this.data.types.map((type) => type.name);\n        setTypes(typeNames);\n    }\n\n    protected render(): HTMLElement {\n        if (!this.data) {\n            return (\n                <div class=\"loading-screen\">\n                    <div class=\"loading-screen-icon\"></div>\n                    <div class=\"loading-screen-text\">Loading...</div>\n                </div>\n            );\n        }\n\n        return (\n            <div class=\"kompendium-body\">\n                <kompendium-navigation\n                    menu={this.data.menu}\n                    header={this.data.title}\n                    logo={this.data.logo}\n                    index={this.index}\n                />\n                <main role=\"main\">\n                    <stencil-router>\n                        <stencil-route-switch scrollTopOffset={0}>\n                            <stencil-route\n                                url=\"/\"\n                                component=\"kompendium-markdown\"\n                                componentProps={{\n                                    text: this.data.readme,\n                                }}\n                            />\n                            <stencil-route\n                                url=\"/component/:name/:section?\"\n                                component=\"kompendium-component\"\n                                componentProps={{\n                                    docs: this.data.docs,\n                                    schemas: this.data.schemas,\n                                    examplePropsFactory:\n                                        this.examplePropsFactory,\n                                }}\n                            />\n                            <stencil-route\n                                url=\"/type/:name\"\n                                component=\"kompendium-type\"\n                                componentProps={{\n                                    types: this.data.types,\n                                }}\n                            />\n                            <stencil-route\n                                url=\"/debug/:name\"\n                                component=\"kompendium-debug\"\n                                componentProps={{\n                                    docs: this.data.docs,\n                                    schemas: this.data.schemas,\n                                    examplePropsFactory:\n                                        this.examplePropsFactory,\n                                }}\n                            />\n                            <stencil-route\n                                component=\"kompendium-guide\"\n                                componentProps={{\n                                    data: this.data,\n                                }}\n                            />\n                        </stencil-route-switch>\n                    </stencil-router>\n                </main>\n            </div>\n        );\n    }\n}\n\nfunction getSocketUrl(location: Location) {\n    const protocol = location.protocol === 'https:' ? 'wss:' : 'ws:';\n\n    return `${protocol}//${location.hostname}:${location.port}/`;\n}\n"]}