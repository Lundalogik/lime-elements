{"version":3,"file":"limel-icon.entry.esm.js","sources":["src/global/icon-cache/cache-storage-icon-cache.ts","src/global/icon-cache/in-memory-icon-cache.ts","src/global/icon-cache/factory.ts","src/components/icon/icon.scss?tag=limel-icon&encapsulation=shadow","src/components/icon/icon.tsx"],"sourcesContent":["export class CacheStorageIconCache {\n    /*\n     * Cache of all loaded SVGs\n     */\n    private cache: Promise<Cache>;\n\n    private promises: Record<string, Promise<void>> = {};\n\n    constructor(cache: Promise<Cache>) {\n        this.cache = cache;\n    }\n\n    /**\n     * Get icon data from the cache\n     *\n     * @param name - Name of the icon\n     * @param path - Path on the server where the assets are located\n     * @returns SVG markup\n     */\n    public async get(name: string, path = ''): Promise<string> {\n        const cache = await this.cache;\n        const url = this.getUrl(name, path);\n\n        let response = await cache.match(url);\n        if (!response) {\n            response = await this.fetchData(url, cache);\n        }\n\n        return this.getIcon(response);\n    }\n\n    private async fetchData(url: string, cache: Cache): Promise<Response> {\n        let requestPromise = this.promises[url];\n        if (requestPromise === undefined) {\n            requestPromise = cache.add(url);\n            this.promises[url] = requestPromise;\n        }\n\n        await requestPromise;\n\n        return cache.match(url);\n    }\n\n    /*\n     * Get icon data from a response\n     */\n    private async getIcon(response: Response): Promise<string> {\n        let svgData = await response.text();\n\n        // Some of the icons in the Icons8 library have hard coded black color on some of the paths.\n        // In order to apply coloring with CSS, these have to be set to 'currentColor'\n        svgData = svgData.replaceAll('#000000', 'currentColor');\n\n        if (!this.validSvg(svgData)) {\n            throw new Error('Invalid SVG');\n        }\n\n        return svgData;\n    }\n\n    /*\n     * Check if the given data is a valid SVG document\n     */\n    private validSvg(data) {\n        const parser = new DOMParser();\n        const svgDoc = parser.parseFromString(data, 'image/svg+xml');\n\n        return svgDoc.documentElement.tagName.toLowerCase() === 'svg';\n    }\n\n    private getUrl(name: string, path: string): string {\n        let iconPath = path || '';\n        if (path && !path.endsWith('/')) {\n            iconPath = `${path}/`;\n        }\n\n        return `${iconPath}assets/icons/${name}.svg`;\n    }\n}\n","export class InMemoryIconCache {\n    /*\n     * Cache of all loaded SVGs\n     */\n    private cache = {};\n\n    /*\n     * Contains resolve functions for all unresolved promises that are waiting for SVG data.\n     */\n    private resolveFunctions = {};\n\n    /**\n     * Get icon data from the cache\n     *\n     * @param name - Name of the icon\n     * @param path - Path on the server where the assets are located\n     * @returns SVG markup\n     */\n    public async get(name: string, path = ''): Promise<string> {\n        if (!this.cache[name]) {\n            this.cache[name] = await this.getIcon(name, path);\n        }\n\n        return this.cache[name];\n    }\n\n    /*\n     * Creates and returns a promise that will be resolved when SVG data is available\n     */\n    private getIcon(name, path) {\n        return new Promise((resolve) => {\n            if (!this.resolveFunctions[name]) {\n                this.resolveFunctions[name] = [];\n                this.fetchData(name, path);\n            }\n\n            this.resolveFunctions[name].push(resolve);\n        });\n    }\n\n    /*\n     * Fetch SVG data from the server\n     */\n    private async fetchData(name, path) {\n        let iconPath = path || '';\n        if (path && !path.endsWith('/')) {\n            iconPath = `${path}/`;\n        }\n\n        const response = await fetch(`${iconPath}assets/icons/${name}.svg`);\n\n        let svgData = await response.text();\n\n        // Some of the icons in the Icons8 library have hard coded black color on some of the paths.\n        // In order to apply coloring with CSS, these have to be set to 'currentColor'\n        svgData = svgData.replaceAll('#000000', 'currentColor');\n        if (!this.validSvg(svgData)) {\n            throw new Error('Invalid SVG');\n        }\n\n        this.resolvePromises(name, svgData);\n    }\n\n    /*\n     * Check if the given data is a valid SVG document\n     */\n    private validSvg(data) {\n        const parser = new DOMParser();\n        const svgDoc = parser.parseFromString(data, 'image/svg+xml');\n\n        return svgDoc.documentElement.tagName.toLowerCase() === 'svg';\n    }\n\n    /*\n     * Resolve all promises waiting for data for a specific icon\n     */\n    private resolvePromises(name, svgData) {\n        const resolves = this.resolveFunctions[name];\n        for (const resolve of resolves) {\n            resolve(svgData);\n        }\n        this.resolveFunctions[name] = null;\n    }\n}\n","import { CacheStorageIconCache } from './cache-storage-icon-cache';\nimport { InMemoryIconCache } from './in-memory-icon-cache';\n\nconst CACHE_NAME = '@limetech/lime-elements/icons';\n\nfunction createIconCache() {\n    try {\n        const cache = caches.open(CACHE_NAME);\n\n        return new CacheStorageIconCache(cache);\n    } catch {\n        return new InMemoryIconCache();\n    }\n}\n\nexport default (() => {\n    return createIconCache();\n})();\n","/**\n * @prop --icon-background-color: Background color when attribute `badge` is set to `true`. Defaults to `transparent`.\n */\n\n:host {\n    background-color: var(--icon-background-color, transparent);\n    border-radius: 50%;\n    display: inline-block;\n    line-height: 0;\n    box-sizing: border-box;\n\n    svg {\n        fill: currentColor;\n        height: 100%;\n        pointer-events: none;\n        width: 100%;\n    }\n\n    div {\n        margin: var(--limel-icon-svg-margin, 0);\n    }\n}\n\n:host([hidden]) {\n    display: none;\n}\n\n:host([size='x-small']) {\n    height: 1rem !important;\n    width: 1rem !important;\n}\n:host([size='small']) {\n    height: 1.25rem !important;\n    width: 1.25rem !important;\n}\n:host([size='medium']) {\n    height: 1.5rem !important;\n    width: 1.5rem !important;\n}\n:host([size='large']) {\n    height: 1.75rem !important;\n    width: 1.75rem !important;\n}\n\n:host([badge][size='x-small']) {\n    height: 1.5rem !important;\n    width: 1.5rem !important;\n\n    --limel-icon-svg-margin: 0.25rem;\n}\n:host([badge][size='small']) {\n    height: 1.75rem !important;\n    width: 1.75rem !important;\n\n    --limel-icon-svg-margin: 0.25rem;\n}\n:host([badge][size='medium']) {\n    height: 2.5rem !important;\n    width: 2.5rem !important;\n\n    --limel-icon-svg-margin: 0.5rem;\n}\n:host([badge][size='large']) {\n    height: 2.75rem !important;\n    width: 2.75rem !important;\n\n    --limel-icon-svg-margin: 0.5rem;\n}\n","import { Component, Element, h, Prop, Watch } from '@stencil/core';\nimport { globalConfig } from '../../global/config';\nimport iconCache from '../../global/icon-cache/factory';\nimport { IconSize } from './icon.types';\n\n/**\n * :::important\n * To install your icon set correctly, please read the [documentation here](#/).\n * :::\n *\n * The size and color of the icon is normally set in CSS, however there are a few\n * standard sizes defined that can be used with the `size` property.\n *\n * @exampleComponent limel-example-icon-name\n * @exampleComponent limel-example-icon-size\n * @exampleComponent limel-example-icon-color\n */\n@Component({\n    tag: 'limel-icon',\n    shadow: true,\n    styleUrl: 'icon.scss',\n})\nexport class Icon {\n    /**\n     * Size of the icon\n     */\n    @Prop({ reflect: true })\n    public size: IconSize;\n\n    /**\n     * Name of the icon\n     */\n    @Prop({ reflect: true })\n    public name: string;\n\n    /**\n     * Set to `true` to give the icon a round background with some padding.\n     * Only works when the `size` attribute is also set.\n     */\n    @Prop({ reflect: true })\n    public badge: boolean;\n\n    @Element()\n    private host: HTMLLimelIconElement;\n\n    public componentDidLoad() {\n        this.loadIcon(this.name);\n    }\n\n    public render() {\n        return <div class=\"container\" />;\n    }\n\n    @Watch('name')\n    protected async loadIcon(name: string) {\n        if (name === undefined || name === '') {\n            return;\n        }\n\n        const svgData = await this.loadSvg(name);\n        this.renderSvg(svgData);\n    }\n\n    /**\n     * Load the SVG data for the icon from the icon cache\n     *\n     * @param name - name of the icon\n     * @returns the icon SVG data\n     */\n    private loadSvg(name: string) {\n        return iconCache.get(name, globalConfig.iconPath);\n    }\n\n    /*\n     * There is no way to style external SVG files with CSS, i.e. SVGs loaded\n     * with <img src=\"file.svg\" /> or <object data=\"file.svg\" type=\"image/svg+xml\" />\n     * will remain the way they look in the file.\n     * Therefore we inject the svg as inline markup instead.\n     */\n    private renderSvg(svgData: string) {\n        const container = this.host.shadowRoot.querySelector('div.container');\n        if (container) {\n            container.innerHTML = svgData;\n        }\n    }\n}\n"],"names":[],"mappings":"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"}