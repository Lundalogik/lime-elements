{"version":3,"file":"limel-example-text-editor-with-inline-images-file-storage.entry.esm.js","sources":["src/components/text-editor/examples/text-editor-with-inline-images-file-storage.tsx"],"sourcesContent":["import { Component, h, State, Host } from '@stencil/core';\nimport {\n    ImageInserter,\n    FileInfo,\n    EditorImage,\n    LimelTextEditorCustomEvent,\n    LimelCheckboxCustomEvent,\n    EditorMetadata,\n} from '@limetech/lime-elements';\n/**\n * Handling inline images (with external file storage)\n *\n * To allow users to paste images directly into the text editor, you can\n * listen to the `imagePasted` event, which is triggered when an image file\n * is pasted into the editor.\n *\n * The `imagePasted` event contains an `ImageInserter` object, which you can\n * use to insert a thumbnail of the pasted image into the editor.\n * After the thumbnail is inserted, you can upload the image to an external\n * file storage and insert the src url of the uploaded image using the\n * `insertImage` method.\n *\n * If the image upload fails, you can insert a failed thumbnail using the\n * `insertFailedThumbnail` method.\n *\n * :::note\n * In this example, because we don't actually upload the image you paste\n * anywhere, once the \"upload\" is done, we will replace the image you\n * pasted with a url to an image of the Lime CRM logo.\n *\n * In reality, you would of course insert the url to the newly uploaded\n * image instead.\n */\n@Component({\n    tag: 'limel-example-text-editor-with-inline-images-file-storage',\n    shadow: true,\n})\nexport class TextEditorWithInlineImagesExample {\n    @State()\n    private value = 'Copy an image file and paste it here.';\n\n    @State()\n    private uploadImageFails = false;\n\n    private metadata: EditorMetadata = { links: [], images: [] };\n\n    public render() {\n        return (\n            <Host>\n                <limel-text-editor\n                    value={this.value}\n                    onChange={this.handleChange}\n                    onImagePasted={this.handleImagePasted}\n                    onMetadataChange={this.handleMetadataChange}\n                />\n                <limel-checkbox\n                    label=\"Upload image fails - insert failed thumbnail\"\n                    onChange={this.handleFailedThumbnailChange}\n                />\n                <limel-example-value label=\"Value\" value={this.value} />\n            </Host>\n        );\n    }\n\n    private handleFailedThumbnailChange = (\n        event: LimelCheckboxCustomEvent<boolean>\n    ) => {\n        this.uploadImageFails = event.detail;\n    };\n\n    private handleChange = (event: LimelTextEditorCustomEvent<string>) => {\n        this.value = event.detail;\n    };\n\n    private handleImagePasted = async (\n        event: LimelTextEditorCustomEvent<ImageInserter>\n    ) => {\n        const imageInserter = event.detail;\n\n        imageInserter.insertThumbnail();\n\n        const imageSrc = await this.uploadImage(imageInserter.fileInfo);\n        if (imageSrc) {\n            imageInserter.insertImage(imageSrc);\n        } else {\n            imageInserter.insertFailedThumbnail();\n        }\n    };\n\n    private uploadImage = async (fileInfo: FileInfo): Promise<string> => {\n        try {\n            // Upload image to external file storage.\n            // fileInfo.fileContent contains the image data.\n\n            // Simulate upload delay.\n            const imageSrc: string = await new Promise((resolve, reject) => {\n                setTimeout(() => {\n                    if (this.uploadImageFails) {\n                        reject('Server error');\n                    } else {\n                        resolve('https://cdn.lime-crm.com/mail-addin-logo.png');\n                    }\n                }, 2000);\n            });\n\n            // Return the src url of the uploaded image.\n            return imageSrc;\n        } catch (error) {\n            console.error(\n                `Failed to upload image ${fileInfo.filename}: ${error}`\n            );\n        }\n    };\n\n    private handleMetadataChange = (\n        event: LimelTextEditorCustomEvent<EditorMetadata>\n    ) => {\n        const removedImages = this.getRemovedImages(\n            this.metadata,\n            event.detail\n        );\n\n        for (const image of removedImages) {\n            if (image.state === 'success') {\n                this.removeImage(image);\n            }\n        }\n\n        this.metadata = event.detail;\n    };\n\n    private getRemovedImages(\n        oldMetadata: EditorMetadata,\n        newMetadata: EditorMetadata\n    ): EditorImage[] {\n        const newImageIds = new Set(\n            newMetadata.images.map((image) => image.fileInfoId)\n        );\n\n        return oldMetadata.images.filter(\n            (image) => !newImageIds.has(image.fileInfoId)\n        );\n    }\n\n    private removeImage(image: EditorImage) {\n        // Remove image from external file storage if desired.\n        console.log(`Image removed: ${image.fileInfoId}`);\n    }\n}\n"],"names":[],"mappings":"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"}