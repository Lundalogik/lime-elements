{"version":3,"names":["textEditorCustomTriggersCss","TextEditorCustomTriggersExample","constructor","hostRef","this","value","triggerState","tagValue","isPickerOpen","insertMode","contentType","items","text","icon","selected","insertModeButtons","id","title","contentTypeButtons","handleKeyPress","event","capturedKeys","ESCAPE","ARROW_UP","ARROW_DOWN","ENTER","TAB","includes","key","stopPropagation","preventDefault","moveSelection","selectedItem","visibleItems","find","item","insertItem","_a","triggerFunction","stopTrigger","direction","increment","numberOfItems","length","currentSelectionIndex","findIndex","selectionIndex","removeAllSelections","setSelection","map","currentItem","Object","assign","selectedItemId","index","isSelected","renderPicker","h","open","openDirection","onClose","handleTriggerStop","renderList","style","padding","onInteract","handleListInteraction","handleTriggerStart","detail","textEditor","handleTriggerChange","toLowerCase","handleChange","handleInsertModeChange","handleContentTypeChange","insertHtml","then","console","log","catch","error","insert","node","tagName","attributes","children","watchOpen","setupEventHandlers","watchTagValue","filter","componentWillLoad","host","addEventListener","capture","removeEventListener","render","class","onChange","display","customElements","triggers","onTriggerStart","onTriggerStop","onTriggerChange","label"],"sources":["src/components/text-editor/examples/text-editor-custom-triggers.scss?tag=limel-example-text-editor-triggers&encapsulation=shadow","src/components/text-editor/examples/text-editor-custom-triggers.tsx"],"sourcesContent":["limel-button-group {\n    min-width: 8rem;\n}\n\nlimel-example-controls {\n    display: flex;\n    flex-wrap: wrap;\n}\n\n.mode {\n    display: flex;\n    flex-wrap: nowrap;\n}\n\n.value {\n    display: flex;\n    gap: 0.5rem;\n}\n\nlimel-portal {\n    width: auto;\n}\n","import {\n    Button,\n    LimelMenuListCustomEvent,\n    MenuItem,\n} from '@limetech/lime-elements';\nimport { Component, h, State, Element, Watch } from '@stencil/core';\nimport {\n    ARROW_DOWN,\n    ARROW_UP,\n    ENTER,\n    ESCAPE,\n    TAB,\n} from '../../../util/keycodes';\nimport { TextEditor, TriggerEventDetail } from '../text-editor.types';\n\n/**\n * Custom triggers\n *\n * A trigger is a character or sequence of characters that if typed in the text editor\n * will initiate a trigger session. The session is initialized with a `triggerStart`\n * event. Subsequent characters written after the trigger sequence will be sent in a\n * `triggerChange` event. When the focus is removed from the trigger a `triggerStop`\n * event will be sent.\n *\n * The `triggerStart` event contains a `TextEditorInserter` object containing functions\n * to manipulate the state of the text editor around the trigger. Using any of the\n * supplied methods will effectivly replace the trigger content in the text editor with\n * the content of choice.\n *\n * In this example we pass either plain text, HTML string, or a `limel-chip`\n * representing some chosen user in a mention like situation.\n *\n * :::note\n * Changing the contentType resets the text editor with an empty value.\n */\n@Component({\n    tag: 'limel-example-text-editor-triggers',\n    shadow: true,\n    styleUrl: 'text-editor-custom-triggers.scss',\n})\nexport class TextEditorCustomTriggersExample {\n    @State()\n    private value: string = '';\n\n    @State()\n    private triggerState: string = '';\n\n    @State()\n    private tagValue: string = '';\n\n    @State()\n    private isPickerOpen: boolean = false;\n\n    @State()\n    private insertMode: 'text' | 'chip' | 'html' = 'text';\n\n    @State()\n    private contentType: 'markdown' | 'html' = 'markdown';\n\n    @State()\n    private items: Array<MenuItem<number>> = [\n        { text: 'Wolverine', value: 1, icon: 'wolf', selected: true },\n        { text: 'Captain America', value: 2, icon: 'captain_america' },\n        { text: 'Superman', value: 3, icon: 'superman' },\n        { text: 'Tony Stark', value: 4, icon: 'iron_man' },\n        { text: 'Batman', value: 5, icon: 'batman_old' },\n    ];\n\n    @State()\n    private visibleItems: Array<MenuItem<number>>;\n\n    @Element()\n    private host: HTMLLimelPopoverElement;\n\n    private insertModeButtons: Button[] = [\n        {\n            id: '1',\n            title: 'text',\n            selected: true,\n        },\n        {\n            id: '2',\n            title: 'chip',\n        },\n        {\n            id: '3',\n            title: 'html',\n        },\n    ];\n\n    private contentTypeButtons: Button[] = [\n        {\n            id: '1',\n            title: 'markdown',\n            selected: true,\n        },\n        {\n            id: '2',\n            title: 'html',\n        },\n    ];\n\n    private triggerFunction?: TextEditor;\n\n    @Watch('isPickerOpen')\n    protected watchOpen() {\n        this.setupEventHandlers();\n    }\n\n    @Watch('tagValue')\n    protected watchTagValue() {\n        if (this.isPickerOpen) {\n            this.visibleItems = this.items.filter((item: MenuItem<number>) =>\n                item.text.toLowerCase().includes(this.tagValue)\n            );\n        }\n    }\n    public componentWillLoad() {\n        this.visibleItems = this.items;\n        this.setupEventHandlers();\n    }\n\n    private setupEventHandlers() {\n        if (this.isPickerOpen) {\n            this.host.addEventListener('keydown', this.handleKeyPress, {\n                capture: true,\n            });\n        } else {\n            this.host.removeEventListener('keydown', this.handleKeyPress, {\n                capture: true,\n            });\n        }\n    }\n\n    private handleKeyPress = (event: KeyboardEvent) => {\n        const capturedKeys = [ESCAPE, ARROW_UP, ARROW_DOWN, ENTER, TAB];\n        if (capturedKeys.includes(event.key)) {\n            event.stopPropagation();\n            event.preventDefault();\n        }\n\n        if (event.key === ARROW_DOWN || event.key === ARROW_UP) {\n            this.moveSelection(event.key);\n        }\n\n        if (event.key === ENTER || event.key === TAB) {\n            const selectedItem: MenuItem | undefined = this.visibleItems.find(\n                (item) => item.selected\n            );\n\n            if (selectedItem) {\n                this.insertItem(selectedItem);\n            }\n        }\n\n        if (event.key === ESCAPE) {\n            this.isPickerOpen = false;\n            this.triggerFunction?.stopTrigger();\n        }\n    };\n\n    private moveSelection = (\n        direction: typeof ARROW_UP | typeof ARROW_DOWN\n    ) => {\n        const increment = direction === ARROW_DOWN ? 1 : -1;\n        const numberOfItems = this.visibleItems.length;\n        const currentSelectionIndex = this.visibleItems.findIndex(\n            (item) => item.selected\n        );\n\n        const selectionIndex =\n            (currentSelectionIndex + increment + numberOfItems) % numberOfItems;\n\n        this.removeAllSelections();\n        this.setSelection(selectionIndex);\n    };\n\n    private removeAllSelections = () => {\n        this.items = this.items.map((currentItem) => {\n            currentItem.selected = false;\n\n            return { ...currentItem };\n        });\n    };\n\n    private setSelection = (selectionIndex: number) => {\n        let selectedItemId;\n        this.visibleItems = this.visibleItems.map((item, index) => {\n            const isSelected = index === selectionIndex;\n\n            if (isSelected) {\n                selectedItemId = item.value;\n            }\n\n            return { ...item, selected: isSelected };\n        });\n\n        if (selectedItemId) {\n            this.items[selectedItemId - 1].selected = true;\n        }\n    };\n\n    public render() {\n        return [\n            <limel-example-controls>\n                <label>\n                    contentType:\n                    <limel-button-group\n                        class=\"mode\"\n                        value={this.contentTypeButtons}\n                        onChange={this.handleContentTypeChange}\n                    />\n                </label>\n            </limel-example-controls>,\n            this.renderPicker(),\n            <limel-text-editor\n                style={{ display: 'block' }}\n                value={this.value}\n                customElements={[\n                    { tagName: 'limel-chip', attributes: ['text', 'icon'] },\n                ]}\n                triggers={['@']}\n                onTriggerStart={this.handleTriggerStart}\n                onTriggerStop={this.handleTriggerStop}\n                onTriggerChange={this.handleTriggerChange}\n                onChange={this.handleChange}\n                contentType={this.contentType}\n                key={this.contentType}\n            />,\n            <limel-example-controls>\n                <label>\n                    Insert mode:\n                    <limel-button-group\n                        class=\"mode\"\n                        value={this.insertModeButtons}\n                        onChange={this.handleInsertModeChange}\n                    />\n                </label>\n                <div class=\"value\">\n                    <limel-example-value\n                        label=\"Action\"\n                        value={this.triggerState}\n                    />\n                    <limel-example-value\n                        label=\"Tag value\"\n                        value={this.tagValue}\n                    />\n                </div>\n            </limel-example-controls>,\n            <limel-example-value value={this.value} />,\n        ];\n    }\n\n    private renderPicker = () => {\n        return (\n            <limel-popover\n                open={this.isPickerOpen}\n                openDirection=\"top-start\"\n                onClose={this.handleTriggerStop}\n            >\n                {this.renderList(this.visibleItems)}\n            </limel-popover>\n        );\n    };\n\n    private renderList = (items: Array<MenuItem<number>>) => {\n        if (items.length === 0) {\n            return (\n                <div style={{ padding: '0.5rem' }}>\n                    Couldn't find. Not a hero yet! ðŸ¥²\n                </div>\n            );\n        }\n\n        return (\n            <limel-menu-list\n                items={items}\n                onInteract={this.handleListInteraction}\n            />\n        );\n    };\n\n    private handleTriggerStart = (event: CustomEvent<TriggerEventDetail>) => {\n        this.triggerState = 'start';\n        this.isPickerOpen = true;\n        this.triggerFunction = event.detail.textEditor;\n    };\n\n    private handleTriggerStop = () => {\n        this.triggerState = 'stop';\n        this.tagValue = '';\n        this.isPickerOpen = false;\n    };\n\n    private handleTriggerChange = (event: CustomEvent<TriggerEventDetail>) => {\n        this.tagValue = event.detail.value.toLowerCase();\n    };\n\n    private handleChange = (event: CustomEvent<string>) => {\n        this.value = event.detail;\n    };\n\n    private handleListInteraction = (\n        event: LimelMenuListCustomEvent<MenuItem<number>>\n    ) => {\n        this.insertItem(event.detail);\n    };\n\n    private handleInsertModeChange = (event: CustomEvent<Button>) => {\n        this.insertMode = event.detail.title as any;\n    };\n\n    private handleContentTypeChange = (event: CustomEvent<Button>) => {\n        this.contentType = event.detail.title as any;\n        this.value = '';\n    };\n\n    private insertItem = (item: MenuItem) => {\n        this.removeAllSelections();\n        this.visibleItems = this.items;\n\n        if (this.insertMode === 'html') {\n            this.triggerFunction\n                .insertHtml(`<strong>${item.text}</strong>`)\n                .then(() => console.log('HTML inserted successfully'))\n                .catch((error) =>\n                    console.error('Error inserting HTML:', error)\n                );\n\n            return;\n        }\n\n        if (this.insertMode === 'text') {\n            this.triggerFunction.insert('@' + item.text);\n\n            return;\n        }\n\n        this.triggerFunction.insert({\n            node: {\n                tagName: 'limel-chip',\n                attributes: {\n                    icon: item.icon,\n                    text: item.text,\n                },\n            },\n            children: [\"I'm a teapot\"],\n        });\n    };\n}\n"],"mappings":"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","ignoreList":[]}