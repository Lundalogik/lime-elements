{"version":3,"file":"source.js","sourceRoot":"","sources":["../../src/kompendium/source.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n    JsonDocs,\n    JsonDocsComponent,\n    JsonDocsTag,\n} from '@stencil/core/internal';\nimport { readFile } from 'fs/promises';\nimport { extname, join } from 'path';\n\nexport interface JsonDocsSource {\n    filename: string;\n    type: 'tsx' | 'ts' | 'scss' | 'less' | 'css';\n    source: string;\n}\n\nexport async function addSources(docs: JsonDocs): Promise<JsonDocs> {\n    const components = await Promise.all(\n        docs.components?.map(addComponentSources) || [],\n    );\n\n    return {\n        ...docs,\n        components: components,\n    };\n}\n\nexport async function addComponentSources(\n    component: JsonDocsComponent,\n): Promise<any> {\n    const sources = await getSources(component);\n\n    return {\n        ...component,\n        sources: sources,\n    };\n}\n\nexport async function getSources(\n    component: JsonDocsComponent,\n): Promise<JsonDocsSource[]> {\n    const source = await readFile(component.filePath, 'utf8');\n    const styleNames = getStyleFiles(source);\n    const styles = await Promise.all(\n        styleNames.map(getStyle(component.dirPath)),\n    );\n    const links = await getLinkedSourceFiles(component);\n\n    return [\n        {\n            filename: component.fileName,\n            type: 'tsx',\n            source: source,\n        },\n        ...styles,\n        ...links,\n    ];\n}\n\nexport function getStyleFiles(source: string): string[] {\n    const result = [];\n    let regex = /@Component\\((\\{.+?\\})\\)/s;\n    let match = regex.exec(source);\n    const config = match && match[1];\n\n    if (!config) {\n        return result;\n    }\n\n    regex = /styleUrl:.+?['\"](.+?)['\"]/s;\n    match = regex.exec(config);\n\n    if (match && match[1]) {\n        result.push(match[1]);\n    }\n\n    return result;\n}\n\nconst getStyle =\n    (path: string) =>\n    async (name: string): Promise<JsonDocsSource> => {\n        const source = await readFile([path, name].join('/'), 'utf8');\n\n        return {\n            filename: name,\n            type: 'scss',\n            source: source,\n        };\n    };\n\nasync function getLinkedSourceFiles(\n    component: JsonDocsComponent,\n): Promise<JsonDocsSource[]> {\n    const deprecatedLinkTags = component.docsTags.filter(\n        (tag) => tag.name === 'link',\n    );\n    if (deprecatedLinkTags.length > 0) {\n        // eslint-disable-next-line no-console\n        console.warn(\n            'Using the @link tag to link source files for display alongside examples is deprecated. ' +\n                'Use @sourceFile instead.',\n        );\n    }\n\n    const linkTags = component.docsTags.filter(\n        (tag) => tag.name === 'sourceFile',\n    );\n    const backwardsCompatibleLinkTags = [...linkTags, ...deprecatedLinkTags];\n\n    return Promise.all<JsonDocsSource>(\n        backwardsCompatibleLinkTags.map(getLink(component)),\n    );\n}\n\nconst getLink =\n    (component: JsonDocsComponent) =>\n    async (tag: JsonDocsTag): Promise<JsonDocsSource> => {\n        let source: string;\n        try {\n            source = await readFile(join(component.dirPath, tag.text), 'utf8');\n        } catch {\n            source = `File ${tag.text} not found`;\n        }\n\n        return {\n            filename: tag.text,\n            type: extname(tag.text).replace('.', '') as any,\n            source: source,\n        };\n    };\n"]}