@use '../../style/functions';
@use '../../style/internal/shared_input-select-picker';
@use '../../style/mixins';

@import '@limetech/mdc-select/mdc-select';
@import '@limetech/mdc-select/helper-text/mdc-select-helper-text';
@import '@limetech/mdc-floating-label/mdc-floating-label';

@import './partial-styles/_readonly.scss';

// Note! The `--dropdown-z-index` property is used from `select.tsx`.
/**
 * @prop --dropdown-z-index: z-index of the dropdown menu.
 */

:host {
    display: block;
    position: relative;
    height: shared_input-select-picker.$height-of-mdc-text-field;
}

:host([hidden]) {
    display: none;
}

.limel-select__selected-option {
    display: flex;
    align-items: center;

    box-sizing: border-box;
    outline: none;

    padding: 0 functions.pxToRem(16);
    align-self: center;
    min-width: 0; // makes it truncate and prevents the select to grow wider than its container
}

.limel-select__selected-option__icon {
    margin-right: functions.pxToRem(8);
    flex-shrink: 0;
}

.limel-select__selected-option__text {
    @include shared_input-select-picker.looks-like-input-label;
    @include mixins.truncate-text;
}

.limel-select {
    height: 100%;

    .limel-select-trigger {
        display: inline-flex;
        align-items: center;
        height: 100%;

        cursor: pointer;
        border-radius: functions.pxToRem(5);
        background-color: shared_input-select-picker.$background-color-focused;

        &:focus {
            outline: none;

            .mdc-floating-label {
                color: var(--mdc-theme-primary);
            }
        }
        &:focus-visible {
            box-shadow: var(--shadow-depth-8-focused) !important;
        }

        .mdc-floating-label {
            @include shared_input-select-picker.looks-like-input-label;
            top: 50%;
            right: functions.pxToRem(
                16
            ); //This is a hack to force the label truncate when container is too little. Otherwise due to position: absolute it won't. Kia
            transform: translateY(-50%);

            &.mdc-floating-label--float-above {
                @include shared_input-select-picker.label--float-above;
            }

            &.mdc-floating-label--active {
                color: var(--mdc-theme-primary);
            }
        }
    }

    .mdc-select__dropdown-icon {
        transition: box-shadow 0.2s ease;
        border-radius: 50%;
        background: url("data:image/svg+xml;charset=utf-8,%3Csvg width='10' height='5' viewBox='7 10 10 5' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill-rule='evenodd' opacity='.54' d='M7 10l5 5 5-5z'/%3E%3C/svg%3E")
            no-repeat 50%;

        position: relative;
        bottom: unset;
    }

    .limel-select-trigger,
    .limel-select__selected-option {
        width: 100%;
    }

    &.mdc-select--disabled {
        .limel-select-trigger {
            @include shared_input-select-picker.looks-disabled;
        }
    }

    &:not(.mdc-select--disabled) {
        .limel-select-trigger {
            @include mixins.is-elevated-clickable;

            &.limel-select--focused {
                background-color: shared_input-select-picker.$background-color-focused;

                .mdc-floating-label {
                    color: var(--mdc-theme-primary);
                }

                .mdc-select__dropdown-icon {
                    color: var(--mdc-theme-primary);
                }
            }
        }
    }

    &.limel-select--required {
        .mdc-floating-label::after {
            content: '*';
        }
    }

    &.limel-select--invalid {
        .mdc-floating-label,
        .limel-select__selected-option,
        .mdc-select-helper-text,
        .invalid-icon {
            color: var(--lime-error-text-color);
        }
        .mdc-floating-label:not(.mdc-floating-label--float-above) {
            max-width: calc(
                100% - #{functions.pxToRem(64)}
            ); // leaves space for the invalid-icon
        }
    }
}

.invalid-icon {
    margin-right: functions.pxToRem(8);
    flex-shrink: 0;
}

.mdc-select-helper-line {
    @include shared_input-select-picker.looks-like-helper-line;
}
.mdc-select-helper-text {
    &:before {
        @include shared_input-select-picker.looks-like-helper-text-pseudo-before;
    }
}

select.limel-select__native-control {
    position: absolute;
    top: 0;
    left: 0;

    width: 100%;
    height: 100%;
    opacity: 0;
    border: 0;
}

:host(.is-narrow) {
    height: functions.pxToRem(36);

    .mdc-floating-label {
        &.mdc-floating-label--float-above {
            transform: translateY(-1.76rem) scale(0.75);
        }
    }

    .limel-select__selected-option {
        padding: 0 functions.pxToRem(12);
    }
}
